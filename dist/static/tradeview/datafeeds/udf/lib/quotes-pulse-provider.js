import{getErrorMessage,logMessage}from"./helpers";var QuotesPulseProvider=function(){function e(e){this._subscribers={},this._requestsPending=0,this._quotesProvider=e,setInterval(this._updateQuotes.bind(this,1),1e4),setInterval(this._updateQuotes.bind(this,0),6e4)}return e.prototype.subscribeQuotes=function(e,s,t,r){this._subscribers[r]={symbols:e,fastSymbols:s,listener:t},logMessage("QuotesPulseProvider: subscribed quotes with #"+r)},e.prototype.unsubscribeQuotes=function(e){delete this._subscribers[e],logMessage("QuotesPulseProvider: unsubscribed quotes with #"+e)},e.prototype._updateQuotes=function(e){var s=this;if(!(this._requestsPending>0)){var t=function(t){r._requestsPending++;var i=r._subscribers[t];r._quotesProvider.getQuotes(1===e?i.fastSymbols:i.symbols).then((function(r){s._requestsPending--,s._subscribers.hasOwnProperty(t)&&(i.listener(r),logMessage("QuotesPulseProvider: data for #"+t+" ("+e+") updated successfully, pending="+s._requestsPending))})).catch((function(r){s._requestsPending--,logMessage("QuotesPulseProvider: data for #"+t+" ("+e+") updated with error="+getErrorMessage(r)+", pending="+s._requestsPending)}))},r=this;for(var i in this._subscribers)t(i)}},e}();export{QuotesPulseProvider};